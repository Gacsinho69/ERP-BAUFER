<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Template principal de cotización BAUFER - Diseño Profesional Minimalista -->
    <template id="report_saleorder_document_baufer" inherit_id="sale.report_saleorder_document">

        <!-- Reemplazar todo el header -->
        <xpath expr="//div[hasclass('page')]/div[1]" position="replace">

            <!-- Header minimalista con logo y datos de empresa -->
            <div class="baufer-header">
                <div class="row align-items-center">
                    <div class="col-7">
                        <img src="/baufer_sale_report/static/src/img/baufer_logo.png"
                             alt="BAUFER"
                             class="baufer-logo"/>
                    </div>
                    <div class="col-5 text-right">
                        <div class="baufer-company-info">
                            <div class="company-name">Inversiones Séneca SpA.</div>
                            <div class="company-details">RUT 77.912.335-9</div>
                            <div class="company-details">El Bosque Norte 200, Of. 701</div>
                            <div class="company-details">Providencia, Santiago</div>
                            <div class="company-email">contacto@baufer.cl</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Separador minimalista -->
            <div class="baufer-divider"/>

            <!-- Título del documento -->
            <div class="baufer-doc-title">
                <div class="row">
                    <div class="col-6">
                        <h2 class="doc-type">COTIZACIÓN</h2>
                    </div>
                    <div class="col-6 text-right">
                        <div class="doc-number"><span t-field="doc.name"/></div>
                        <div class="doc-date"><span t-field="doc.date_order" t-options='{"widget": "date", "format": "dd/MM/yyyy"}'/></div>
                    </div>
                </div>
            </div>

            <!-- Información del cliente - Grid minimalista -->
            <div class="baufer-client-section">
                <div class="section-label">CLIENTE</div>
                <div class="row baufer-info-row">
                    <div class="col-6">
                        <div class="info-group">
                            <span class="info-label">Nombre</span>
                            <span class="info-value"><span t-field="doc.partner_id.name"/></span>
                        </div>
                        <div class="info-group" t-if="doc.partner_id.street">
                            <span class="info-label">Dirección</span>
                            <span class="info-value"><span t-field="doc.partner_id.street"/></span>
                        </div>
                        <div class="info-group" t-if="doc.customer_branch">
                            <span class="info-label">Sucursal</span>
                            <span class="info-value"><span t-field="doc.customer_branch"/></span>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="info-group" t-if="doc.customer_contact_name">
                            <span class="info-label">Contacto</span>
                            <span class="info-value"><span t-field="doc.customer_contact_name"/></span>
                        </div>
                        <div class="info-group" t-if="doc.customer_contact_email">
                            <span class="info-label">Email</span>
                            <span class="info-value"><span t-field="doc.customer_contact_email"/></span>
                        </div>
                        <div class="info-group" t-if="doc.customer_contact_phone">
                            <span class="info-label">Teléfono</span>
                            <span class="info-value"><span t-field="doc.customer_contact_phone"/></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Información del vehículo (si existe) -->
            <div class="baufer-vehicle-section" t-if="doc.vehicle_brand or doc.vehicle_model or doc.vehicle_plate or doc.vehicle_vin">
                <div class="section-label">VEHÍCULO</div>
                <div class="row baufer-info-row">
                    <div class="col-6">
                        <div class="info-group" t-if="doc.vehicle_brand">
                            <span class="info-label">Marca</span>
                            <span class="info-value"><span t-field="doc.vehicle_brand"/></span>
                        </div>
                        <div class="info-group" t-if="doc.vehicle_model">
                            <span class="info-label">Modelo</span>
                            <span class="info-value"><span t-field="doc.vehicle_model"/></span>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="info-group" t-if="doc.vehicle_plate">
                            <span class="info-label">Patente</span>
                            <span class="info-value"><span t-field="doc.vehicle_plate"/></span>
                        </div>
                        <div class="info-group" t-if="doc.vehicle_vin">
                            <span class="info-label">VIN</span>
                            <span class="info-value"><span t-field="doc.vehicle_vin"/></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Etiqueta de sección de productos -->
            <div class="section-label" style="margin-top: 30px;">DETALLE</div>
        </xpath>

        <!-- Reemplazar la tabla de productos - Diseño minimalista -->
        <xpath expr="//table[@name='sale_order_line_table']" position="replace">
            <table class="baufer-products-table" name="sale_order_line_table">
                <thead>
                    <tr>
                        <th class="col-qty">CANT.</th>
                        <th class="col-code">CÓDIGO</th>
                        <th class="col-desc">DESCRIPCIÓN</th>
                        <th class="col-origin">ORIGEN</th>
                        <th class="col-price">PRECIO UNIT.</th>
                        <th class="col-total">TOTAL</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="doc.order_line" t-as="line">
                        <tr class="product-line">
                            <td class="col-qty"><span t-field="line.product_uom_qty"/></td>
                            <td class="col-code"><span t-field="line.product_code"/></td>
                            <td class="col-desc"><span t-field="line.name"/></td>
                            <td class="col-origin"><span t-field="line.origin_location"/></td>
                            <td class="col-price">
                                <span t-field="line.price_unit"
                                      t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                            </td>
                            <td class="col-total">
                                <span t-field="line.price_subtotal"
                                      t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                            </td>
                        </tr>
                    </t>
                </tbody>
            </table>
        </xpath>

        <!-- Reemplazar el total - Diseño minimalista y elegante -->
        <xpath expr="//div[@id='total']" position="replace">
            <div id="total" class="baufer-totals-section">
                <div class="row">
                    <div class="col-7"/>
                    <div class="col-5">
                        <div class="totals-container">
                            <!-- Descuento si existe -->
                            <div class="total-line" t-if="doc.amount_total != doc.amount_untaxed">
                                <span class="total-label">Descuento</span>
                                <span class="total-value discount-value">
                                    -<span t-esc="'{:,.0f}'.format(sum(line.product_uom_qty * line.price_unit * (line.discount/100) for line in doc.order_line))"/>
                                </span>
                            </div>

                            <!-- Subtotal -->
                            <div class="total-line">
                                <span class="total-label">Subtotal</span>
                                <span class="total-value">
                                    <span t-field="doc.amount_untaxed"
                                          t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                                </span>
                            </div>

                            <!-- IVA -->
                            <div class="total-line" t-if="doc.amount_tax">
                                <span class="total-label">IVA (19%)</span>
                                <span class="total-value">
                                    <span t-field="doc.amount_tax"
                                          t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                                </span>
                            </div>

                            <!-- Total final -->
                            <div class="total-line total-final">
                                <span class="total-label">TOTAL</span>
                                <span class="total-value">
                                    <span t-field="doc.amount_total"
                                          t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nota al pie minimalista -->
            <div class="baufer-footer-note">
                <p style="margin: 0; font-size: 9px; color: #999;">
                    Esta cotización tiene una validez de 30 días desde la fecha de emisión.
                </p>
            </div>
        </xpath>

    </template>

</odoo>

